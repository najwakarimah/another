<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pop Cat Nana</title>
<style>
  :root{
    --bg1: #0f1724;
    --bg2: #071023;
    --accent: #ffd166;
    --accent-2:#ffaf69;
    --card: rgba(255,255,255,0.04);
    --glass: rgba(255,255,255,0.03);
    --text: #eef2ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;color:var(--text);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px;}
  .app{width:100%;max-width:960px;display:grid;grid-template-columns:1fr 360px;gap:24px}
  @media(max-width:900px){ .app{grid-template-columns:1fr;}}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:16px;padding:22px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 12px 40px rgba(2,6,23,0.6)}
  /* Left: game area */
  .stage{display:flex;flex-direction:column;align-items:center;gap:16px;justify-content:center;height:520px}
  .title{font-size:22px;font-weight:700;letter-spacing:0.4px;display:flex;gap:12px;align-items:center}
  .title .dot{width:10px;height:10px;border-radius:999px;background:var(--accent);box-shadow:0 6px 18px rgba(255,209,102,0.12)}
  .score-big{font-size:56px;font-weight:800;color:var(--accent);text-shadow:0 6px 30px rgba(255,209,102,0.08)}
  /* Cat area */
  .cat-wrap{width:360px;height:360px;border-radius:20px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;position:relative;overflow:visible;box-shadow:0 20px 50px rgba(2,6,23,0.6)}
  .cat-btn{width:320px;height:320px;border-radius:18px;display:flex;align-items:center;justify-content:center;cursor:pointer;touch-action:manipulation;transition:transform .12s ease}
  .cat-btn:active{transform:scale(.98)}
  /* floating +1 */
  .float{position:absolute;font-weight:800;color:var(--accent);font-size:20px;pointer-events:none;animation:floatUp 900ms ease forwards}
  @keyframes floatUp{0%{opacity:1;transform:translateY(0) scale(1)}50%{opacity:1}100%{opacity:0;transform:translateY(-90px) scale(1.06)}}
  /* Right panel */
  .panel{display:flex;flex-direction:column;gap:12px}
  .meta{display:flex;justify-content:space-between;align-items:center;gap:8px}
  .btn{background:var(--glass);padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);cursor:pointer;color:var(--text);font-weight:700}
  .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#072018;border:none;box-shadow:0 8px 30px rgba(255,173,96,0.12)}
  .small{font-size:13px;color:#c7d2fe}
  .row{display:flex;gap:8px;align-items:center}
  .history{max-height:260px;overflow:auto;padding:10px;border-radius:10px;background:rgba(255,255,255,0.01);font-size:14px;color:#dbeafe}
  .stat{display:flex;flex-direction:column;gap:4px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.01)}
  .stat .num{font-size:24px;font-weight:800;color:var(--accent)}
  /* help */
  .hint{opacity:0.9;font-size:13px;color:#cbd5e1}
  footer{margin-top:12px;font-size:12px;color:#9ca3af;text-align:center}
  /* click ripple */
  .ripple{position:absolute;border-radius:50%;background:rgba(255,255,255,0.06);pointer-events:none;transform:scale(0);animation:rippleAnim .6s ease;}
  @keyframes rippleAnim{to{transform:scale(6);opacity:0}}
</style>
</head>
<body>
  <div class="wrap">
    <div class="app">
      <!-- Game Area -->
      <div class="card">
        <div class="stage">
          <div class="title"><span class="dot"></span> <div>POP CAT ‚Äî click & pop!</div></div>
          <div class="score-big" id="score">0</div>

          <div class="cat-wrap" id="catWrap" aria-hidden="false">
            <div class="cat-btn" id="catBtn" title="Klik atau tekan spasi untuk pop">
              <!-- SVG cat with mouth closed and open layers -->
              <svg id="catSVG" width="280" height="280" viewBox="0 0 280 280" xmlns="http://www.w3.org/2000/svg">
                <defs>
                  <linearGradient id="fur" x1="0" x2="1" y1="0" y2="1">
                    <stop offset="0" stop-color="#fffaf0"/>
                    <stop offset="1" stop-color="#ffe2c2"/>
                  </linearGradient>
                  <filter id="soft" x="-20%" y="-20%" width="140%" height="140%">
                    <feGaussianBlur stdDeviation="2"/>
                  </filter>
                </defs>

                <!-- ears -->
                <g id="ears">
                  <path d="M60 70 Q40 30 80 40 Q70 70 60 70" fill="#ffe6c9" stroke="#f0c9a6" stroke-width="2"/>
                  <path d="M220 70 Q240 30 200 40 Q210 70 220 70" fill="#ffe6c9" stroke="#f0c9a6" stroke-width="2"/>
                </g>

                <!-- head -->
                <circle cx="140" cy="130" r="95" fill="url(#fur)" stroke="#f4ccb0" stroke-width="2"/>

                <!-- eyes -->
                <g id="eyes" fill="#2b2b2b">
                  <ellipse cx="105" cy="115" rx="16" ry="18"/>
                  <ellipse cx="175" cy="115" rx="16" ry="18"/>
                  <circle cx="100" cy="110" r="5" fill="#fff"/>
                  <circle cx="170" cy="110" r="5" fill="#fff"/>
                </g>

                <!-- nose -->
                <path d="M140 135 q6 8 -6 8 q-12 0 -6 -8 z" fill="#f2a07d"/>

                <!-- mouth closed (default) -->
                <g id="mouthClosed">
                  <path d="M120 155 q20 18 40 0" stroke="#b14a2b" stroke-width="4" stroke-linecap="round" fill="none"/>
                </g>

                <!-- mouth open (pop) - initially hidden -->
                <g id="mouthOpen" style="display:none">
                  <ellipse cx="140" cy="170" rx="30" ry="22" fill="#2b2b2b"/>
                  <ellipse cx="140" cy="175" rx="20" ry="12" fill="#ff5c6c"/>
                </g>

                <!-- whiskers -->
                <g stroke="#d9b79d" stroke-width="2" stroke-linecap="round">
                  <path d="M80 140 h-30"/>
                  <path d="M80 150 h-28"/>
                  <path d="M200 140 h30"/>
                  <path d="M200 150 h28"/>
                </g>
              </svg>
            </div>
          </div>

          <!-- little floating +1 area container -->
          <div id="floatLayer" style="position:relative;width:320px;height:0;"></div>

          <div class="hint">Tip: klik / tap / tekan <strong>spasi</strong> untuk pop. Dapatkan combo untuk skor lebih cepat!</div>
        </div>
      </div>

      <!-- Right Panel -->
      <div class="panel card">
        <div class="meta">
          <div class="row">
            <div class="small">Score</div>
            <div style="margin-left:8px;font-weight:800;color:var(--accent)"><span id="scoreSmall">0</span></div>
          </div>
          <div class="row">
            <button class="btn" id="soundToggle">üîä On</button>
            <button class="btn" id="resetBtnRight">Reset</button>
          </div>
        </div>

        <div class="stat">
          <div class="small">Highscore</div>
          <div class="num" id="highscore">0</div>
        </div>

        <div class="stat">
          <div class="small">Combo (pops / sec)</div>
          <div class="num" id="cps">0</div>
        </div>

        <div class="small">History (recent pops)</div>
        <div class="history" id="historyBox"></div>

        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn primary" id="popBtnMobile">POP!</button>
          <button class="btn" id="exportBtn">Export</button>
        </div>

        <footer>&copy; Pop Cat ‚Ä¢ Made with ‚ù§Ô∏è</footer>
      </div>
    </div>
  </div>

<script>
/* Pop Cat - JS
   - No external assets
   - Sound made with WebAudio
   - localStorage: key 'popcat_highscore' and 'popcat_history'
*/

const catBtn = document.getElementById('catBtn');
const catSVG = document.getElementById('catSVG');
const mouthOpen = document.getElementById('mouthOpen');
const mouthClosed = document.getElementById('mouthClosed');
const scoreEl = document.getElementById('score');
const scoreSmall = document.getElementById('scoreSmall');
const highEl = document.getElementById('highscore');
const cpsEl = document.getElementById('cps');
const floatLayer = document.getElementById('floatLayer');
const historyBox = document.getElementById('historyBox');
const soundToggle = document.getElementById('soundToggle');

let score = 0;
let high = parseInt(localStorage.getItem('popcat_highscore')||'0',10);
let history = JSON.parse(localStorage.getItem('popcat_history')||'[]');
let soundOn = true;
let lastPopTime = 0;
let popsThisSecond = 0;
let slidingWindow = []; // timestamps of pops for cps
let mouthTimer = null;

highEl.textContent = high;
scoreEl.textContent = score;
scoreSmall.textContent = score;

function saveState(){
  if(score > high){
    high = score;
    localStorage.setItem('popcat_highscore', String(high));
    highEl.textContent = high;
  }
  localStorage.setItem('popcat_history', JSON.stringify(history.slice(-50)));
}

// create beep-like pop with WebAudio
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx = null;
function playPopSound(){
  if(!soundOn) return;
  if(!audioCtx) audioCtx = new AudioCtx();
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = 'triangle';
  o.frequency.setValueAtTime(600, audioCtx.currentTime);
  o.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.12);
  g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.4, audioCtx.currentTime + 0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.18);
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); o.stop(audioCtx.currentTime + 0.2);
}

// tiny 'clack' with filtered noise for body?
function playClack(){
  if(!soundOn) return;
  if(!audioCtx) audioCtx = new AudioCtx();
  const bufferSize = 2*audioCtx.sampleRate;
  const noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
  const output = noiseBuffer.getChannelData(0);
  for(let i=0;i<bufferSize;i++) output[i] = (Math.random()*2-1) * Math.exp(-i/(audioCtx.sampleRate*0.02));
  const whiteNoise = audioCtx.createBufferSource();
  whiteNoise.buffer = noiseBuffer;
  const filter = audioCtx.createBiquadFilter();
  filter.type = 'highpass'; filter.frequency.value = 800;
  const g = audioCtx.createGain(); g.gain.value = 0.06;
  whiteNoise.connect(filter); filter.connect(g); g.connect(audioCtx.destination);
  whiteNoise.start(); whiteNoise.stop(audioCtx.currentTime + 0.06);
}

// pop action
function doPop(by='user'){
  const t = Date.now();
  // visual mouth open
  mouthClosed.style.display = 'none';
  mouthOpen.style.display = 'inline';
  if(mouthTimer) clearTimeout(mouthTimer);
  mouthTimer = setTimeout(()=>{ mouthOpen.style.display='none'; mouthClosed.style.display='inline'; }, 220);

  // animate scale
  catBtn.animate([{transform:'scale(1)'},{transform:'scale(0.96)'},{transform:'scale(1)'}],{duration:180,easing:'cubic-bezier(.2,.8,.2,1)'});

  // sound
  playPopSound();
  playClack();

  // score & cps
  score += 1;
  scoreEl.textContent = score;
  scoreSmall.textContent = score;
  // floating +1
  spawnFloat('+1');

  // record timestamp
  slidingWindow.push(t);
  // keep only last 3s of timestamps
  const cutoff = t - 3000;
  slidingWindow = slidingWindow.filter(ts => ts >= cutoff);
  // cps as pops per second averaged over last 1s
  const cpsCut = t - 1000;
  const cps = slidingWindow.filter(ts => ts >= cpsCut).length;
  cpsEl.textContent = cps;

  // add to history
  history.push({time:t,by});
  if(history.length>200) history.shift();
  renderHistory();

  // save highscore if needed
  saveState();
}

// floating +1
function spawnFloat(text){
  const el = document.createElement('div');
  el.className = 'float';
  el.textContent = text;
  // random x within cat center
  const baseX = Math.random()*140 - 70;
  el.style.left = (160 + baseX) + 'px';
  el.style.top = '80px';
  floatLayer.appendChild(el);
  setTimeout(()=>{ el.remove(); }, 900);
}

// render history
function renderHistory(){
  historyBox.innerHTML = '';
  const recent = history.slice(-20).reverse();
  recent.forEach(h=>{
    const d = new Date(h.time);
    const row = document.createElement('div');
    row.style.padding='6px 8px';
    row.style.borderBottom='1px solid rgba(255,255,255,0.02)';
    row.style.display='flex';
    row.style.justifyContent='space-between';
    row.style.fontSize='13px';
    row.innerHTML = `<div>${h.by==='user'?'You':'Auto'}</div><div style="opacity:.7">${d.toLocaleTimeString()}</div>`;
    historyBox.appendChild(row);
  });
}

// UI: reset
document.getElementById('resetBtnRight').addEventListener('click', resetGame);
document.getElementById('resetBtnRight').addEventListener('touchend', resetGame);
function resetGame(){
  if(!confirm('Reset score dan history?')) return;
  score = 0;
  slidingWindow = [];
  history = [];
  scoreEl.textContent = score;
  scoreSmall.textContent = score;
  cpsEl.textContent = 0;
  localStorage.removeItem('popcat_highscore');
  localStorage.removeItem('popcat_history');
  high = 0;
  highEl.textContent = 0;
  renderHistory();
}

// mobile pop button
document.getElementById('popBtnMobile').addEventListener('click', ()=> doPop('user'));

// export history
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const data = history.map(h => `${new Date(h.time).toLocaleString()} - ${h.by}`).join('\n');
  const w = window.open('', '_blank');
  w.document.write('<pre style="font-family:monospace;padding:10px;white-space:pre-wrap">'+data+'</pre>');
});

// sound toggle
soundToggle.addEventListener('click', ()=>{
  soundOn = !soundOn;
  soundToggle.textContent = soundOn ? 'üîä On' : 'üîá Off';
});

// click / tap handlers + ripple
const catWrap = document.getElementById('catWrap');
catWrap.addEventListener('click', (e)=>{
  doPop('user');
  spawnRipple(e);
});
function spawnRipple(e){
  const r = document.createElement('div');
  r.className = 'ripple';
  const rect = catWrap.getBoundingClientRect();
  const size = Math.max(rect.width, rect.height);
  r.style.width = r.style.height = size + 'px';
  r.style.left = (e.clientX - rect.left - size/2) + 'px';
  r.style.top = (e.clientY - rect.top - size/2) + 'px';
  catWrap.appendChild(r);
  setTimeout(()=> r.remove(), 600);
}

// keyboard space to pop
window.addEventListener('keydown', (e)=>{
  if(e.code === 'Space'){ e.preventDefault(); doPop('user'); }
  if(e.key === 'r' || e.key === 'R') resetGame();
});

// autoplay small random 'idle' pops (simulate crowd) - optional: off by default
let idleEnabled = false;
if(idleEnabled){
  setInterval(()=>{ if(Math.random()<0.1) doPop('auto'); }, 1500);
}

// initial load
function init(){
  // restore history & highscore
  high = parseInt(localStorage.getItem('popcat_highscore')||'0',10);
  history = JSON.parse(localStorage.getItem('popcat_history')||'[]');
  highEl.textContent = high;
  renderHistory();
}
init();
</script>
</body>
</html>
